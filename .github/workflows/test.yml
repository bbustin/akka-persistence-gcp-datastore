name: Test
on: [push, pull_request]
jobs:
    lint:
        runs-on: ubuntu-latest
        steps:
            - uses: actions/checkout@v2
            - name: Cache SBT ivy cache
              uses: actions/cache@v1
              with:
                  path: ~/.ivy2/cache
                  key: ${{ runner.os }}-sbt-ivy-cache-${{ hashFiles('**/build.sbt') }}
            - name: Cache SBT
              uses: actions/cache@v1
              with:
                  path: ~/.sbt
                  key: ${{ runner.os }}-sbt-${{ hashFiles('**/build.sbt') }}
            - name: Set up JDK 11.0.6
              uses: actions/setup-java@v1
              with:
                  java-version: 11.0.6
            - name: Lint
              run: |
                  sbt ++2.13.1! check
    test213_jdk11:
        runs-on: ubuntu-latest
        steps:
            - uses: actions/checkout@v2
            - name: Cache SBT ivy cache
              uses: actions/cache@v1
              with:
                  path: ~/.ivy2/cache
                  key: ${{ runner.os }}-sbt-ivy-cache-${{ hashFiles('**/build.sbt') }}
            - name: Cache SBT
              uses: actions/cache@v1
              with:
                  path: ~/.sbt
                  key: ${{ runner.os }}-sbt-${{ hashFiles('**/build.sbt') }}
            - name: Set up JDK 11.0.6
              uses: actions/setup-java@v1
              with:
                  java-version: 11.0.6
            - name: Setup up Gcloud
              uses: GoogleCloudPlatform/github-actions/setup-gcloud@master
              with:
                  version: '290.0.1'
                  project_id: build
            - name: Test with Scala 2.13.1
              run: |
                  gcloud beta emulators datastore start --no-store-on-disk --consistency=1.0 &
                  sbt ++2.13.1! test
    test212_jdk8:
        runs-on: ubuntu-latest
        steps:
            - uses: actions/checkout@v2
            - name: Cache SBT ivy cache
              uses: actions/cache@v1
              with:
                  path: ~/.ivy2/cache
                  key: ${{ runner.os }}-sbt-ivy-cache-${{ hashFiles('**/build.sbt') }}
            - name: Cache SBT
              uses: actions/cache@v1
              with:
                  path: ~/.sbt
                  key: ${{ runner.os }}-sbt-${{ hashFiles('**/build.sbt') }}
            - name: Set up JDK 8
              uses: actions/setup-java@v1
              with:
                  java-version: 8
            - name: Setup up Gcloud
                uses: GoogleCloudPlatform/github-actions/setup-gcloud@master
                with:
                    version: '290.0.1'
                    project_id: build
            - name: Test with Scala 2.12.10
              run: |
                  gcloud beta emulators datastore start --no-store-on-disk --consistency=1.0 &
                  sbt ++2.12.10! test
